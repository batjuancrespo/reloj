<html><head><base href="/" /><meta charset="UTF-8">
<title>Reloj y Tiempo en Selaya</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/es.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
        color: white;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .main-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 40px;
        margin: 40px 0;
    }

    #current-weather {
        text-align: center;
        font-size: 2em;
    }

    #current-weather img {
        width: 120px;
        height: 120px;
        filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
    }

    @keyframes weather-float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
    }

    #current-weather img {
        animation: weather-float 3s ease-in-out infinite;
    }

    #date-temp {
        text-align: center;
        font-size: 1.5em;
    }

    #current-temp {
        font-size: 2.5em;
        margin: 10px 0;
    }

    #current-date {
        font-size: 1.2em;
        color: #cccccc;
    }

    #clock {
        font-size: 16em; /* Change from current size to 16em */
        font-weight: bold;
        text-shadow: 2px 2px 10px rgba(255,255,255,0.2);
        color: #ffffff;
    }

    .forecast-alarm-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        width: 100%;
        margin: 10px 0;
        height: 150px;
    }

    #weather {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-radius: 10px;
        display: flex;
        gap: 10px;
        justify-content: space-between;
        align-items: center;
        height: 100%;
    }

    .alarm-container {
        display: flex;
        flex-direction: column;
        flex: 1;
        height: 100%;
    }

    .weather-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        padding: 8px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        border-radius: 10px;
        text-align: center;
        flex: 1;
        align-items: center;
    }

    .weather-card .day-name {
        font-size: 0.9em;
        font-weight: bold;
        margin-bottom: 5px;
        color: #ffffff;
    }

    .weather-card .date {
        font-size: 0.7em;
        color: #cccccc;
        margin-bottom: 8px;
    }

    .weather-card img {
        width: 30px;
        height: 30px;
        margin: 5px auto;
        display: block;
    }

    .alarm-list {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-radius: 10px;
    }

    .alarm-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 100%;
        background: transparent;
        padding: 10px;
        border-radius: 12px;
        font-size: 3em;
    }

    .alarm-item .alarm-info {
        display: flex;
        align-items: center;
        flex: 1;
        justify-content: center;
        gap: 10px;
    }

    .alarm-item .bulb {
        color: #FFD700;
        font-size: 2em;
        animation: glow 1.5s ease-in-out infinite;
    }

    @keyframes glow {
        0% { opacity: 0.5; }
        50% { opacity: 1; }
        100% { opacity: 0.5; }
    }

    .alarm-item button {
        background: rgba(255, 0, 0, 0.3);
        border: none;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.4em;
        transition: background 0.3s;
    }

    .alarm-item button:hover {
        background: rgba(255, 0, 0, 0.5);
    }

    .alarm-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
        flex-direction: row;
        align-items: center;
    }

    .time-picker-container {
        display: flex;
        flex-direction: row;
        gap: 10px;
        width: 100%;
        max-width: none;
    }

    .slider-container {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 10px;
        text-align: center;
    }

    .time-slider {
        width: 100%;
        -webkit-appearance: none;
        height: 15px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        margin: 5px 0;
    }

    .time-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 25px;
        height: 25px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
    }

    .time-display {
        font-size: 1.5em;
        font-weight: bold;
        margin: 5px 0;
        min-width: 80px;
    }

    .alarm-button {
        height: fit-content;
        align-self: center;
        padding: 10px 20px;
        font-size: 1em;
        max-width: none;
        margin-left: 10px;
    }

    @keyframes alarm-flash {
        0% { background: rgba(255, 0, 0, 0.2); }
        50% { background: rgba(255, 0, 0, 0.5); }
        100% { background: rgba(255, 0, 0, 0.2); }
    }

    .alarming {
        animation: alarm-flash 1s infinite;
    }

    .news-container {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        min-height: 100px;
        display: block !important;
        position: relative;
        height: 60px;
        overflow: hidden;
    }

    @keyframes fadeInOut {
        0% { opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { opacity: 0; }
    }

    .news-item {
        position: absolute;
        width: calc(100% - 20px);
        opacity: 0;
        animation: fadeInOut 10s;
    }

    .news-item:last-child {
        border-bottom: none;
    }

    .news-item a {
        color: white;
        text-decoration: none;
        font-size: 1.1em;
        display: block;
        padding: 5px 0;
    }

    .news-item a:hover {
        color: #cccccc;
    }

    .mode-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255,255,255,0.2);
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    .photo-frame-mode {
        padding: 0 !important;
        background: black !important;
    }

    .photo-frame-mode .main-display,
    .photo-frame-mode .forecast-alarm-container,
    .photo-frame-mode .news-container {
        display: none !important;
    }

    .photo-frame {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: contain;
        background: black;
    }

    .photo-frame-mode .photo-frame {
        display: block;
    }
</style>
</head>
<body>
    <div class="mode-switch">
        <label class="switch">
            <input type="checkbox" id="modeToggle">
            <span class="slider"></span>
        </label>
    </div>
    <div id="photoFrame" class="photo-frame">
        <!-- Photos will be loaded here -->
    </div>
    <div class="main-display fade-in">
        <div id="current-weather"></div>
        <div id="clock"></div>
        <div id="date-temp">
            <div id="current-temp"></div>
            <div id="current-date"></div>
        </div>
    </div>
    <div class="forecast-alarm-container fade-in">
        <div id="weather"></div>
        <div class="alarm-container">
            <div class="alarm-controls">
                <div class="time-picker-container">
                    <div class="time-display" id="selectedTime">12:00</div>
                    <div class="slider-container">
                        <div>Horas</div>
                        <input type="range" min="0" max="23" value="12" class="time-slider" id="hourSlider">
                    </div>
                    <div class="slider-container">
                        <div>Minutos</div>
                        <input type="range" min="0" max="59" value="0" class="time-slider" id="minuteSlider">
                    </div>
                </div>
                <button class="alarm-button" id="setAlarm">Establecer Alarma</button>
            </div>
            <div class="alarm-list" id="alarmList">
                <!-- Alarm items will be added here dynamically -->
            </div>
        </div>
    </div>
    <div class="news-container" id="news">
        <!-- News items will be added here dynamically -->
    </div>
<script>
moment.locale('es');

const weatherTranslations = {
    'clear sky': 'Cielo despejado',
    'few clouds': 'Algunas nubes',
    'scattered clouds': 'Nubes dispersas',
    'broken clouds': 'Nuboso',
    'shower rain': 'Lluvia débil',
    'rain': 'Lluvia',
    'thunderstorm': 'Tormenta',
    'snow': 'Nieve',
    'mist': 'Niebla',
    'overcast clouds': 'Muy nuboso',
    'light rain': 'Lluvia ligera',
    'moderate rain': 'Lluvia moderada',
    'heavy intensity rain': 'Lluvia fuerte',
    'light intensity drizzle': 'Llovizna ligera',
    'drizzle': 'Llovizna',
    'heavy intensity drizzle': 'Llovizna fuerte',
    'light intensity shower rain': 'Lluvia débil',
    'heavy intensity shower rain': 'Lluvia fuerte',
    'very heavy rain': 'Lluvia muy fuerte',
    'extreme rain': 'Lluvia extrema',
    'freezing rain': 'Lluvia helada',
    'light snow': 'Nieve ligera',
    'heavy snow': 'Nieve fuerte',
    'sleet': 'Aguanieve',
    'light shower sleet': 'Aguanieve ligera',
    'shower sleet': 'Aguanieve',
    'light rain and snow': 'Lluvia y nieve ligera',
    'rain and snow': 'Lluvia y nieve',
    'light shower snow': 'Nevada ligera',
    'shower snow': 'Nevada',
    'heavy shower snow': 'Nevada fuerte',
    'fog': 'Niebla',
    'haze': 'Neblina',
    'smoke': 'Humo',
    'sand/dust whirls': 'Remolinos de polvo',
    'sand': 'Arena',
    'dust': 'Polvo',
    'volcanic ash': 'Ceniza volcánica',
    'squalls': 'Chubascos',
    'tornado': 'Tornado'
};

function updateClock() {
    const now = moment();
    document.getElementById('clock').textContent = now.format('HH:mm');
    document.getElementById('current-date').textContent = now.format('dddd, D [de] MMMM');
}

async function getWeather() {
    const lat = 43.2;
    const lon = -3.8;
    const apiKey = '56463b4abd4cb828b6db3c8395dcedbc';
    
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&cnt=32`);
        const data = await response.json();
        
        const currentWeather = data.list[0];
        const currentTemp = Math.round(currentWeather.main.temp);
        const currentDescription = currentWeather.weather[0].description.toLowerCase();
        const currentIcon = currentWeather.weather[0].icon;
        const translatedCurrentDescription = weatherTranslations[currentDescription] || currentDescription;

        document.getElementById('current-weather').innerHTML = `
            <img src="https://openweathermap.org/img/wn/${currentIcon}@2x.png" alt="${translatedCurrentDescription}">
            <div>${translatedCurrentDescription}</div>
        `;
        
        document.getElementById('current-temp').textContent = `${currentTemp}°C`;

        let weatherHTML = '';
        const forecasts = [];
        const today = moment().startOf('day');
        
        for(let i = 1; i <= 3; i++) {
            const targetDate = moment().add(i, 'days').startOf('day');
            const dayForecast = data.list.find(item => {
                const itemDate = moment(item.dt * 1000);
                return itemDate.isSame(targetDate, 'day') && itemDate.hour() >= 12;
            });
            if (dayForecast) {
                forecasts.push({
                    date: targetDate,
                    forecast: dayForecast
                });
            }
        }

        forecasts.forEach((day) => {
            const dayName = day.date.format('dddd');
            const dateStr = day.date.format('D [de] MMMM');
            const temp = Math.round(day.forecast.main.temp);
            const description = day.forecast.weather[0].description.toLowerCase();
            const translatedDescription = weatherTranslations[description] || description;
            const icon = day.forecast.weather[0].icon;

            weatherHTML += `
                <div class="weather-card">
                    <div class="day-name">${dayName}</div>
                    <div class="date">${dateStr}</div>
                    <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${translatedDescription}">
                    <div>${temp}°C</div>
                    <div>${translatedDescription}</div>
                </div>`;
        });
        
        document.getElementById('weather').innerHTML = weatherHTML;
    } catch (error) {
        console.error('Error fetching weather:', error);
    }
}

let alarms = [];
const alarmSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');

function isAudioPlaying(audio) {
    return audio && !audio.paused && !audio.ended && audio.currentTime > 0;
}

function checkAlarms() {
    const now = moment();
    const currentTime = now.format('HH:mm');
    
    alarms.forEach((alarm, index) => {
        if (alarm && alarm.time === currentTime && !alarm.triggered) {
            triggerAlarm(index);
        }
    });
}

function triggerAlarm(index) {
    alarms[index].triggered = true;
    document.body.classList.add('alarming');
    alarmSound.loop = true;
    alarmSound.play();
}

function stopAlarm(index) {
    alarmSound.pause();
    alarmSound.currentTime = 0;
    document.body.classList.remove('alarming');
    removeAlarm(index);
}

function addAlarm(time) {
    alarms.push({ time, triggered: false });
    updateAlarmList();
    
    const alarmControls = document.querySelector('.alarm-controls');
    alarmControls.style.display = 'none';
}

function removeAlarm(index) {
    alarms.splice(index, 1);
    updateAlarmList();
    
    const alarmControls = document.querySelector('.alarm-controls');
    if (alarms.length === 0) {
        alarmControls.style.display = 'flex';
    }
}

function updateAlarmList() {
    const alarmList = document.getElementById('alarmList');
    alarmList.innerHTML = alarms.map((alarm, index) => `
        <div class="alarm-item">
            <div class="alarm-info">
                <span class="bulb">💡</span>
                <span>${alarm.time}</span>
            </div>
            <button ontouchend="removeAlarm(${index})" onclick="removeAlarm(${index})">
                Cancelar Alarma
            </button>
        </div>
    `).join('');
}

function updateTimeDisplay() {
    const hours = document.getElementById('hourSlider').value.padStart(2, '0');
    const minutes = document.getElementById('minuteSlider').value.padStart(2, '0');
    document.getElementById('selectedTime').textContent = `${hours}:${minutes}`;
}

document.getElementById('hourSlider').addEventListener('input', updateTimeDisplay);
document.getElementById('minuteSlider').addEventListener('input', updateTimeDisplay);

document.getElementById('setAlarm').addEventListener('click', () => {
    const hours = document.getElementById('hourSlider').value.padStart(2, '0');
    const minutes = document.getElementById('minuteSlider').value.padStart(2, '0');
    const time = `${hours}:${minutes}`;
    addAlarm(time);
});

// Add touch feedback
document.querySelectorAll('.alarm-button, .alarm-item button').forEach(button => {
    button.addEventListener('touchstart', function() {
        this.style.opacity = '0.7';
    });
    
    button.addEventListener('touchend', function() {
        this.style.opacity = '1';
    });
});

// Updated news fetching function
async function getNews() {
    const newsFeeds = [
        'https://e00-elmundo.uecdn.es/elmundo/rss/portada.xml',
        'https://www.eldiariomontanes.es/rss/2.0/',
        'https://e00-marca.uecdn.es/rss/portada.xml'
    ];

    const newsContainer = document.getElementById('news');
    let allNews = [];

    try {
        for (const feed of newsFeeds) {
            try {
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed)}`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const newsItems = data.items.slice(0, 10).map(item => ({
                        title: item.title,
                        link: item.link,
                        source: feed.includes('elmundo') ? 'El Mundo' : 
                                feed.includes('montanes') ? 'El Diario Montañés' : 
                                'Marca'
                    }));
                    allNews = [...allNews, ...newsItems];
                }
            } catch (error) {
                console.error(`Error fetching from ${feed}:`, error);
            }
        }

        allNews = allNews.sort(() => Math.random() - 0.5);

        if (allNews.length === 0) {
            newsContainer.innerHTML = '<div class="news-item">No hay noticias disponibles en este momento</div>';
            return;
        }

        let currentIndex = 0;

        function showNextNews() {
            const article = allNews[currentIndex];
            newsContainer.innerHTML = `
                <div class="news-item">
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer">
                        [${article.source}] ${article.title}
                    </a>
                </div>
            `;
            currentIndex = (currentIndex + 1) % allNews.length;
        }

        showNextNews();
        setInterval(showNextNews, 10000);

    } catch (error) {
        console.error('Error in news rotation:', error);
        newsContainer.innerHTML = `
            <div class="news-item">
                Error al cargar las noticias. Intentándolo de nuevo...
            </div>`;
    }
}

setInterval(updateClock, 60000);
updateClock();

getWeather();
setInterval(getWeather, 21600000); // Changed from 900000 to 21600000 (6 hours)

console.log("Fetching initial news...");
getNews();
setInterval(() => {
    console.log("Fetching news update...");
    getNews();
}, 600000); // Changed from 900000 to 600000 (10 minutes)

setInterval(checkAlarms, 1000);

document.body.addEventListener('click', () => {
    if (isAudioPlaying(alarmSound)) {
        alarms.forEach((alarm, index) => {
            if (alarm && alarm.triggered) {
                stopAlarm(index);
            }
        });
    }
});

document.body.addEventListener('touchend', () => {
    if (isAudioPlaying(alarmSound)) {
        alarms.forEach((alarm, index) => {
            if (alarm && alarm.triggered) {
                stopAlarm(index);
            }
        });
    }
});

let photoMode = false;

function initGooglePhotos() {
    if (!gapi) {
        console.error('Google API not loaded');
        return;
    }

    gapi.load('client:auth2', () => {
        gapi.client.init({
            apiKey: 'YOUR_API_KEY',
            clientId: 'YOUR_CLIENT_ID',
            discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/photoslibrary/v1/rest'],
            scope: 'https://www.googleapis.com/auth/photoslibrary.readonly'
        }).then(() => {
            if (gapi.auth2 && gapi.auth2.getAuthInstance()) {
                if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
                    loadPhotos();
                } else {
                    gapi.auth2.getAuthInstance().signIn().then(loadPhotos);
                }
            }
        }).catch(error => {
            console.error('Error initializing Google API:', error);
        });
    });
}

async function loadPhotos() {
    try {
        const response = await gapi.client.photoslibrary.mediaItems.list({
            pageSize: 100
        });
        const photos = response.result.mediaItems;
        if (photos && photos.length) {
            startPhotoSlideshow(photos);
        }
    } catch (error) {
        console.error('Error loading photos:', error);
    }
}

function startPhotoSlideshow(photos) {
    let currentIndex = 0;
    const photoFrame = document.getElementById('photoFrame');
    
    function showNextPhoto() {
        if (!photoMode) return;
        const photo = photos[currentIndex];
        photoFrame.style.backgroundImage = `url(${photo.baseUrl})`;
        currentIndex = (currentIndex + 1) % photos.length;
    }
    
    showNextPhoto();
    setInterval(showNextPhoto, 10000);
}

document.getElementById('modeToggle').addEventListener('change', function(e) {
    photoMode = e.target.checked;
    document.body.classList.toggle('photo-frame-mode', photoMode);
    
    if (photoMode) {
        if (typeof gapi !== 'undefined' && gapi.auth2) {
            const auth = gapi.auth2.getAuthInstance();
            if (auth && !auth.isSignedIn.get()) {
                initGooglePhotos();
            }
        } else {
            initGooglePhotos();
        }
    }
});
</script>
</body></html>
