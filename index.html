<!DOCTYPE html>
<html lang="es" style="height: 100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Reloj y Tiempo en Selaya</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/es.js"></script>
    
    <style>
        /* CSS optimizado para máxima compatibilidad */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: sans-serif; background: #000; color: white; display: flex; flex-direction: column; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .container { display: flex; flex-direction: column; flex-grow: 1; padding: 10px; }
        .main-display { display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        #current-weather { text-align: center; font-size: 1.2em; flex: 1; }
        #current-weather img { width: 60px; height: 60px; }
        #clock { font-size: 7em; font-weight: bold; text-align: center; flex-shrink: 0; padding: 0 15px; }
        #date-temp { text-align: center; font-size: 1.2em; flex: 1; }
        #current-temp { font-size: 2em; margin-bottom: 5px; }
        #current-date { font-size: 1em; color: #ccc; }
        .middle-section { display: flex; height: 140px; }
        #weather { flex-basis: 50%; margin-right: 10px; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 10px; display: flex; justify-content: space-between; }
        .weather-card { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 5px; }
        .weather-card .day-name { font-size: 1em; font-weight: bold; }
        .weather-card img { width: 40px; height: 40px; margin: 5px 0; }
        .weather-card .temp { font-size: 1.2em; font-weight: bold; }
        .alarm-container { flex-basis: 50%; margin-left: 10px; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 10px; display: flex; flex-direction: column; }
        .alarm-controls { display: flex; flex-direction: column; }
        .time-picker-container { display: flex; }
        .slider-container { flex-grow: 1; text-align: center; }
        .time-slider { width: 95%; }
        .time-controls { display: flex; flex-direction: column; justify-content: center; margin-left: 10px; }
        .time-display { font-size: 1.8em; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .alarm-button { padding: 8px; font-size: 0.9em; border-radius: 8px; border: none; background: #2196F3; color: white; }
        .alarm-list { flex-grow: 1; display: flex; justify-content: center; align-items: center; }
        .alarm-item { display: flex; justify-content: space-between; align-items: center; font-size: 1.5em; width: 100%; }
        .alarm-item button { padding: 8px; font-size: 0.8em; background: rgba(255, 0, 0, 0.5); color: white; border: none; border-radius: 8px; }
        .news-panels { display: flex; margin-top: 15px; flex-grow: 1; min-height: 80px; }
        .news-container { flex: 1; background: rgba(255, 255, 255, 0.05); padding: 10px 15px; border-radius: 10px; position: relative; overflow: hidden; }
        .news-container:first-child { margin-right: 10px; }
        .news-container h3 { font-size: 1em; margin-bottom: 8px; }
        .news-item { position: absolute; opacity: 0; transition: opacity 0.5s; }
        .news-item.active { opacity: 1; }
        .news-item a { color: white; text-decoration: none; font-size: 1em; }
        #quote-section { width: 100%; margin-top: 10px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; text-align: right; overflow: hidden; color: rgba(255, 255, 255, 0.8); }
        .quote-text { font-size: 1.1em; font-style: italic; margin-bottom: 5px; }
        .quote-author { font-size: 1em; font-weight: bold; }
        @keyframes slideInFromRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .quote-content.animate { -webkit-animation: slideInFromRight 1.5s ease-out forwards; animation: slideInFromRight 1.5s ease-out forwards; }
    </style>
</head>
<body ontouchstart="">
    <div class="container">
        <div class="main-display">
            <div id="current-weather"></div>
            <div id="clock">00:00</div>
            <div id="date-temp"><div id="current-temp">--°C</div><div id="current-date">Cargando...</div></div>
        </div>
        <div class="middle-section">
            <div id="weather"></div>
            <div class="alarm-container">
                <div class="alarm-controls"><div class="time-picker-container"><div class="slider-container"><div>Horas</div><input type="range" min="0" max="23" value="7" class="time-slider" id="hourSlider"><div>Minutos</div><input type="range" min="0" max="59" value="30" class="time-slider" id="minuteSlider"></div><div class="time-controls"><div class="time-display" id="selectedTime">07:30</div><button class="alarm-button" id="setAlarm">Fijar</button></div></div></div>
                <div class="alarm-list" id="alarmList"></div>
            </div>
        </div>
        <div class="news-panels">
            <div class="news-container" id="generalNews"><h3>Noticias Generales</h3></div>
            <div class="news-container" id="sportsNews"><h3>Noticias Deportivas</h3></div>
        </div>
        <div id="quote-section"><div class="quote-content"><div class="quote-text"></div><div class="quote-author"></div></div></div>
    </div>

<script>
// ----- INICIO DEL SCRIPT (VERSIÓN COMPATIBLE) -----
moment.locale('es');
function pad(num) { return ('0' + num).slice(-2); }
const weatherTranslations = { 'clear sky': 'Despejado', 'few clouds': 'Pocas nubes', 'scattered clouds': 'Nubes dispersas', 'broken clouds': 'Nuboso', 'shower rain': 'Lluvia débil', 'rain': 'Lluvia', 'thunderstorm': 'Tormenta', 'snow': 'Nieve', 'mist': 'Niebla', 'overcast clouds': 'Muy nuboso', 'light rain': 'Lluvia ligera' };
const quotes = [ { text: "La vida no es la que uno vivió, sino la que uno recuerda y cómo la recuerda para contarla.", author: "Gabriel García Márquez" }, { text: "En la vida no hay nada que temer, solo hay que comprender.", author: "Marie Curie" }, { text: "La creatividad es la inteligencia divirtiéndose.", author: "Albert Einstein" }, { text: "El único modo de hacer un gran trabajo es amar lo que haces.", author: "Steve Jobs" } ];

function updateClock() { document.getElementById('clock').textContent = moment().format('HH:mm'); document.getElementById('current-date').textContent = moment().format('dddd, D [de] MMMM'); }
function updateQuote() { var cw = document.querySelector('#quote-section .quote-content'), qt = document.querySelector('.quote-text'), qa = document.querySelector('.quote-author'); cw.classList.remove('animate'); void cw.offsetWidth; var rq = quotes[Math.floor(Math.random()*quotes.length)]; qt.textContent = '"'+rq.text+'"'; qa.textContent = '- '+rq.author; cw.classList.add('animate'); }

function getWeather() {
    fetch('https://api.openweathermap.org/data/2.5/forecast?lat=43.2&lon=-3.8&appid=56463b4abd4cb828b6db3c8395dcedbc&units=metric&cnt=32')
    .then(function(r) { if (!r.ok) throw new Error('Network error'); return r.json(); })
    .then(function(d) {
        var cw = d.list[0], icon = cw.weather[0].icon, desc = weatherTranslations[cw.weather[0].description.toLowerCase()] || cw.weather[0].description;
        document.getElementById('current-weather').innerHTML = '<img src="https://openweathermap.org/img/wn/'+icon+'@2x.png" alt="'+desc+'"><div>'+desc+'</div>';
        document.getElementById('current-temp').textContent = Math.round(cw.main.temp)+'°C';
        var html = '';
        var forecasts = [];
        for (var i = 1; i <= 3; i++) {
            var target = moment().add(i, 'days').startOf('day');
            var f = d.list.find(function(item) { return moment(item.dt*1000).isSame(target,'day') && moment(item.dt*1000).hour()>=12; });
            if(f) forecasts.push(f);
        }
        forecasts.forEach(function(day) {
            var dayName = moment(day.dt*1000).format('ddd'), icon = day.weather[0].icon, desc = weatherTranslations[day.weather[0].description.toLowerCase()] || day.weather[0].description;
            html += '<div class="weather-card"><div class="day-name">'+dayName+'</div><img src="https://openweathermap.org/img/wn/'+icon+'.png" alt="'+desc+'"><div class="temp">'+Math.round(day.main.temp)+'°C</div></div>';
        });
        document.getElementById('weather').innerHTML = html;
    }).catch(function(e) { console.error('Weather Error:', e); document.getElementById('weather').innerHTML = '<p>Error Tiempo</p>'; });
}

function createNewsRotator(containerId, feeds) {
    var container = document.getElementById(containerId);
    var allNews = [], currentIndex = 0;
    function fetchNews() {
        var promises = feeds.map(function(feed) {
            return fetch('https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(feed))
            .then(function(r) { return r.json(); }).catch(function() { return null; });
        });
        Promise.all(promises).then(function(results) {
            var items = [];
            results.forEach(function(data) { if (data && data.status === 'ok' && data.items) { data.items.slice(0, 5).forEach(function(item) { items.push({ title: item.title, link: item.link }); }); } });
            if (items.length > 0) { allNews = items; currentIndex = 0; showNextNews(); }
        });
    }
    function showNextNews() {
        if (allNews.length === 0) return;
        var old = container.querySelector('.news-item');
        if(old) container.removeChild(old);
        var article = allNews[currentIndex], item = document.createElement('div');
        item.className = 'news-item';
        item.innerHTML = '<a href="'+article.link+'" target="_blank">'+article.title+'</a>';
        container.appendChild(item);
        void item.offsetWidth; item.classList.add('active');
        currentIndex = (currentIndex + 1) % allNews.length;
    }
    fetchNews(); setInterval(fetchNews, 600000); setInterval(showNextNews, 8000);
}

var alarms = [], alarmSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
alarmSound.loop = true;
function checkAlarms() { var t = moment().format('HH:mm'); alarms.forEach(function(a, i) { if (a.time === t && !a.triggered) { alarms[i].triggered = true; alarmSound.play().catch(function(e){}); } }); }
function addAlarm(t) { if (alarms.length === 0) { alarms.push({ time: t, triggered: false }); updateAlarmList(); } }
function removeAlarm(i) { alarms.splice(i, 1); updateAlarmList(); }
function updateAlarmList() {
    var list = document.getElementById('alarmList'), controls = document.querySelector('.alarm-controls');
    if (alarms.length > 0) {
        controls.style.display = 'none';
        list.innerHTML = alarms.map(function(a, i) { return '<div class="alarm-item"><span>'+a.time+'</span><button ontouchend="removeAlarm('+i+')" onclick="removeAlarm('+i+')">Cancelar</button></div>'; }).join('');
    } else { controls.style.display = 'flex'; list.innerHTML = ''; }
}
function updateTimeDisplay() { var h = pad(document.getElementById('hourSlider').value), m = pad(document.getElementById('minuteSlider').value); document.getElementById('selectedTime').textContent = h+':'+m; }
document.getElementById('hourSlider').addEventListener('input', updateTimeDisplay);
document.getElementById('minuteSlider').addEventListener('input', updateTimeDisplay);
document.getElementById('setAlarm').addEventListener('click', function() { var h = pad(document.getElementById('hourSlider').value), m = pad(document.getElementById('minuteSlider').value); addAlarm(h+':'+m); });

function init() {
    updateClock(); setInterval(updateClock, 15000);
    updateQuote(); setInterval(updateQuote, 20000);
    setInterval(checkAlarms, 1000);
    getWeather(); setInterval(getWeather, 1800000);
    createNewsRotator('generalNews', ['https://e00-elmundo.uecdn.es/elmundo/rss/portada.xml', 'https://www.eldiariomontanes.es/rss/2.0/?section=ultima-hora']);
    createNewsRotator('sportsNews', ['https://e00-marca.uecdn.es/rss/futbol/primera-division.xml', 'https://www.eldiariomontanes.es/rss/2.0/?section=deportes']);
    updateTimeDisplay(); updateAlarmList();
    console.log("Smart Clock Initialized. Compatibility Mode.");
}
init();
</script>
</body>
</html>
